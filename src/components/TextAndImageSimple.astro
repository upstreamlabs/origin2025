---
// Components
import Button from "components/Button.astro";

interface Props {
	title: string,
    text: string,
    image?: string | string[],
    imageAlt?: string | string[],
    textAlign?: 'left' | 'right',
    ctaButton?: {
        text: string,
        link: string,
        openInNewTab?: boolean,
    };
    id?: string;
    theme?: 'light' | 'dark';
    background?: 'light' | 'lightgray' | 'dark' | 'primary';
    backgroundSvg?: string;
    pdfLink?: string;
    githubLinks?: string[];
    logoScale?: number;
}

const {
  title,
  text,
  image,
  imageAlt,
  textAlign = 'left',
  ctaButton,
  id,
  theme = 'dark',
  background = 'dark',
  backgroundSvg,
  pdfLink,
  githubLinks = [],
  logoScale = 1,
} = Astro.props;

const imageSources = Array.isArray(image) ? image : image ? [image] : [];
const altSources = Array.isArray(imageAlt)
  ? imageAlt
  : imageAlt
  ? [imageAlt]
  : imageSources.map(() => title);

const gradientPairs = [
  "linear-gradient(135deg, rgba(88, 140, 255, 0.25), rgba(255, 204, 130, 0.25))",
  "linear-gradient(135deg, rgba(150, 190, 255, 0.25), rgba(255, 160, 122, 0.25))",
  "linear-gradient(135deg, rgba(106, 215, 196, 0.25), rgba(255, 225, 140, 0.25))",
  "linear-gradient(135deg, rgba(120, 190, 255, 0.25), rgba(195, 140, 255, 0.25))",
];

const sectionStyle = backgroundSvg
  ? `--project-bg: url('${backgroundSvg}');
     --project-gradient: ${gradientPairs[
       (title?.length ?? 0) % gradientPairs.length
     ]};`
  : undefined;

const resourceLinks = [
  ...(pdfLink ? [{ label: "Download PDF", href: pdfLink }] : []),
  ...githubLinks.map((href) => {
    const cleaned = href.replace(/\/+$/, "");
    const segments = cleaned.split("/");
    const repoName = segments[segments.length - 1] || "GitHub";
    return {
      label: repoName,
      href,
    };
  }),
];

const getLogoStyle = (idx: number) =>
  logoScale !== 1 ? `transform: scale(${logoScale});` : undefined;
---

<section
    class={`section section-register-gosim spotlight-section project-spotlight ${textAlign === 'right' ? 'text-right' : ''}`}
    id={id ?? 'spotlight'}
    data-theme-section={theme}
    data-bg-section={background}
    style={sectionStyle}
>
    <div class="container">
        <div class="row grid">
            <div class="col">
                <div class="col-row col-row-title">
                    <h2 class="custom3">{title}</h2>
                </div>

                <div class="col-row col-row-text styled-content">
                    <p>
                        {text}
                    </p>
                </div>

                {(resourceLinks.length > 0 || ctaButton?.text) &&
                    <div class="col-row col-row-btn">
                        {resourceLinks.length > 0 && (
                          <div class="resource-links">
                            {resourceLinks.map(link => (
                              <a
                                class="resource-pill"
                                href={link.href}
                                target="_blank"
                                rel="noopener"
                              >
                                {link.label}
                              </a>
                            ))}
                          </div>
                        )}
                        {ctaButton?.text && (
                          <Button
                              text={ctaButton.text}
                              link={ctaButton.link}
                              openInNewTab={ctaButton?.openInNewTab}
                              class="btn outline xl btn-hover"
                          />
                        )}
                    </div>
                }
            </div>

            {imageSources.length > 0 &&
                <div class="col">
                    <div class="logo-tiles">
                        {imageSources.map((src, idx) => (
                          <div class="logo-wrapper" style={getLogoStyle(idx)}>
                            <img
                              src={src}
                              alt={altSources[idx] ?? altSources[0] ?? title}
                              class="hexbadge"
                              loading="lazy"
                            />
                          </div>
                        ))}
                    </div>
                </div>
            }
        </div>
    </div>
</section>

<style>
  .project-spotlight {
    position: relative;
    overflow: hidden;
    background: var(--project-gradient, linear-gradient(135deg, rgba(88, 140, 255, 0.25), rgba(255, 204, 130, 0.25)));
  }

  .project-spotlight::after {
    content: "";
    position: absolute;
    inset: 0;
    background-image: var(--project-bg);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    opacity: 0.55;
    mix-blend-mode: screen;
    animation: project-bg-pan 18s ease-in-out infinite alternate;
  }

  .project-spotlight > .container {
    position: relative;
  }

  .project-spotlight .col-row-title h2,
  .project-spotlight .col-row-text p,
  .project-spotlight .resource-pill,
  .project-spotlight .resource-pill:hover {
    color: #111421;
  }

  .project-spotlight .resource-pill {
    background: rgba(0, 0, 0, 0.08);
    border-color: rgba(0, 0, 0, 0.15);
  }

  .project-spotlight .resource-pill:hover {
    background: rgba(0, 0, 0, 0.16);
  }

  .section-register-gosim.text-right .row.grid {
    flex-direction: row-reverse;
  }
  
  .col-row-title h2 {
    font-size: 2rem;
    line-height: 1.2;
  }

  @keyframes project-bg-pan {
    0% {
      transform: scale(1) translateY(0);
      opacity: 0.5;
    }
    100% {
      transform: scale(1.05) translateY(-2%);
      opacity: 0.65;
    }
  }
  
  @media (max-width: 768px) {
    .section-register-gosim .row.grid {
      flex-direction: column;
    }
    
    .col-row-title h2 {
      font-size: 1.5rem;
    }
  }

  .logo-tiles {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
    align-items: center;
  }

  .logo-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .logo-tiles img {
    max-width: 160px;
    width: auto;
    height: auto;
    filter: drop-shadow(0 6px 20px rgba(0, 0, 0, 0.35));
  }

  @media (max-width: 640px) {
    .logo-tiles img {
      max-width: 120px;
    }
  }

  .col-row-btn {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.75rem;
  }

  .resource-links {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-items: center;
  }

  .resource-pill {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.45rem 1rem;
    border-radius: 999px;
    font-size: 0.85rem;
    color: #f3f4f6;
    background: rgba(255, 255, 255, 0.12);
    border: 1px solid rgba(255, 255, 255, 0.25);
    text-decoration: none;
    transition: background 0.2s ease;
  }

  .resource-pill:hover {
    background: rgba(255, 255, 255, 0.2);
  }
</style>
